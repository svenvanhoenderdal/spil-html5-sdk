<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- portal tags added to test the meta tags that spil uses on their pages for siteid -->
    <meta property="portal:site:id" content="1">
    <meta property="portal:channel:id" content="1">
    <title>HTML5 Sample SDK</title>
    <meta name="description" content="Html5-sdk-sample">
    <meta name="author" content="Rob.vanDiepen">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="js/dotjs.min.js"></script>
    <script src="js/main.js"></script>
    <script src="../dist/spil-sdk.js"></script>
</head>
<body>

    <div class="panel with-nav-tabs panel-default">
        <div class="panel-heading">
            <ul class="nav nav-tabs nav-tabs-sm">
                <li class="active"><a href="#game_config" data-toggle="tab">Game Config</a></li>
                <li><a href="#custom_event" data-toggle="tab">Custom Events</a></li>
                <li><a href="#packages" data-toggle="tab">Packages</a></li>
                <li><a href="#playerdata" data-toggle="tab">Playerdata</a></li>
                <li><a href="#ingameshop" data-toggle="tab">Ingame Shop</a></li>
            </ul>
        </div>
        <div class="panel-body">
            <div class="tab-content">
                <div class="tab-pane fade in active" id="game_config">
                    <button id="game_config_refresh" onclick="SpilSDK.refreshConfig()">Refresh GameConfig</button>
                    <br>
                    <span id="game_config_area"></span>
                </div>
                <div class="tab-pane fade" id="custom_event">
                    <input id="custom_event_name" type="text" value="milestoneAchieved">
                    <input id="custom_event_data" type="text" value="{}">
                    <button id="custom_evend_send" onclick="send_custom_event()">Send custom event</button>
                    <br>
                    <span>Result: </span>
                    <span id="custom_event_result"></span>
                </div>
                <div class="tab-pane fade" id="packages">
                    <button id="request_packages" onclick="SpilSDK.requestPackages()">Update packages and promotions</button>
                    <ul id='package_list'></ul>
                </div>
                <div class="tab-pane fade" id="playerdata">

                    <button id="getwallet" onclick="SpilSDK.getWallet()">SpilSDK.getWallet()</button>

                    <div>
                        <button id="getcurrencies">SpilSDK.getWallet()</button>

                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" style="width:400px;"></div>


                    </div>
                    <script>
                        $('#getcurrencies').click(function(){

                            var currencies = SpilSDK.getWallet().currencies;



                            var tempFn = doT.template(''+
                                '<div class="panel panel-default">'+
                                    '<div class="panel-heading" role="tab" id="panel_{{=it.id}}">'+
                                        '<div class="panel-title" style="font-size:12px">'+
                                            '<a role="button" data-toggle="collapse" href="#body_{{=it.id}}">{{=it.name}}} (id:{{=it.currencyId}})</a>'+
                                            '<span class="badge pull-right" >{{=it.currentBalance}}</span>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div id="body_{{=it.id}}" class="panel-collapse collapse">'+
                                        '<div class="panel-body">' +
                                            '<span>{{=it.currentBalance}}</span>' +
                                            '<div class="btn btn-primary decrement">-</div>' +
                                            '<input type="amount" class="inputfield" value="1">'+
                                            '<div class="btn btn-primary increment">+</div>' +
                                            '<div class="btn btn-primary savewallet" data-id="{{=it.currencyId}}" >save</div>' +
                                            '<div class="btn btn-primary test" data-id="{{=it.currencyId}}" >test</div>' +
                                        '</div>'+
                                    '</div>'+
                                '</div>');

                            $('#accordion').on('click','.decrement',function(){

                                var valueField = $(this).parent().find('.inputfield');

                                $(valueField).val(parseInt(valueField.val())-1);
                            });

                            $('#accordion').on('click','.increment',function(){

                                var valueField = $(this).parent().find('.inputfield');

                                $(valueField).val(parseInt(valueField.val())+1);
                            });

                            $('#accordion').on('click','.savewallet',function(){
                                var valueField = $(this).parent().find('.inputfield');
                                //currencyId, delta, reason
                                SpilSDK.addCurrencyToWallet(parseInt($(this).data('id')),valueField.val(),'ItemBought');
                            });
                            $('#accordion').on('click','.test',function(){
                                var valueField = $(this).parent().find('.inputfield');
                                //currencyId, delta, reason
                                SpilSDK.addCurrencyToWallet(parseInt($(this).data('id')),valueField.val(),'Kak');
                            });

                            for(var i=0;i<currencies.length;i++){
                                var currency = currencies[i];

                                $('#accordion').append(tempFn({
                                    name:currency.name,
                                    currentBalance:currency.currentBalance,
                                    id:i,
                                    currencyId:currency.id
                                }))

                            }

                        });
                    </script>

                </div>
                <div class="tab-pane fade" id="ingameshop">
                    <button id="ingameshop" onclick="refreshShop()">RefreshShop</button>
                    <li id="ingameshopTabTemplate" class="hidden"><a class="ingameshopTabButton" href="#ingameshopTabPlaceholder" data-toggle="tab">Placeholder</a></li>
                    <div id="ingameshopTabPlaceholder" class="tab-pane fade ">
                        <ul class="ingameshopEntryList">
                            <li id="ingameshopEntryTemplate" class="hidden">
                                <span class="bundleHolder"></span><span class="labelHolder"></span> <span class="buttonHolder"></span>
                            </li>
                        </ul>
                    </div>
                    <div class="panel with-nav-tabs panel-default">
                        <div class="panel-heading">
                            <ul id="ingameshopTabList" class="nav nav-tabs nav-tabs-sm"></ul>
                        </div>
                        <div class="panel-body">
                            <div id="ingameShopEntriesList" class="tab-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
